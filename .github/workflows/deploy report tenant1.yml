name: Deploy reports

on: 
  workflow_dispatch:
    inputs:
      report:
        description: 'Report to deploy'
        required: true
        type: choice
        options:
          - Report1
          - Report2
      environments:
        description: 'Environments to deploy'
        required: true
        default: '["Tenant1", "Tenant2"]'
        type: string

jobs:
  deploy:
    runs-on: windows-latest
    strategy:
      max-parallel: 1
      fail-fast: false
      matrix:
        environments: ${{ fromJson(inputs.environments) }}
        
    environment: ${{ matrix.environment }}
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install Power BI Management Module
      run: |
        Install-Module -Name MicrosoftPowerBIMgmt -Force -Scope CurrentUser
        Import-Module MicrosoftPowerBIMgmt

    - name: Run PowerShell script
      run: |
        $param1 = $env:PARAM1
        $param2 = '${{ github.event.inputs.param2 }}'
        .\DeployScript\script.ps1 -Param1 $param1 -Param2 $param2
      shell: pwsh